name: Upstream Sync

permissions:
  contents: write
  issues: write
  actions: write

on:
  schedule:
    - cron: '0 */6 * * *' # every 6 hours
  workflow_dispatch:

jobs:
  sync_latest_from_upstream:
    name: Sync latest commits from upstream repo
    runs-on: ubuntu-latest
    if: ${{ github.event.repository.fork }}

    steps:
      - uses: actions/checkout@v4

      - name: Clean issue notice
        uses: actions-cool/issues-helper@v3
        with:
          actions: 'close-issues'
          labels: 'ğŸš¨ Sync Fail'

      - name: Sync upstream changes
        id: sync
        uses: aormsby/Fork-Sync-With-Upstream-action@v3.4
        with:
          upstream_sync_repo: CherryHQ/cherry-studio-app # å·²ä¿®æ”¹ä¸ºæ–°çš„ä¸Šæ¸¸é¡¹ç›®
          upstream_sync_branch: main
          target_sync_branch: main
          target_repo_token: ${{ secrets.GITHUB_TOKEN }} # automatically generated, no need to set
          test_mode: false

      - name: Sync check
        if: failure()
        uses: actions-cool/issues-helper@v3
        with:
          actions: 'create-issue'
          title: 'ğŸš¨ åŒæ­¥å¤±è´¥ | Sync Fail'
          labels: 'ğŸš¨ Sync Fail'
          body: |
            Due to a change in the workflow file of the upstream repository, GitHub has automatically suspended the scheduled automatic update. You need to manually sync your fork. Please refer to the detailed tutorial for instructions.
            ç”±äºä¸Šæ¸¸ä»“åº“çš„ workflow æ–‡ä»¶å˜æ›´ï¼Œå¯¼è‡´ GitHub è‡ªåŠ¨æš‚åœäº†æœ¬æ¬¡è‡ªåŠ¨æ›´æ–°ï¼Œä½ éœ€è¦æ‰‹åŠ¨ Sync Fork ä¸€æ¬¡ï¼Œè¯·æŸ¥çœ‹è¯¦ç»†æ•™ç¨‹ã€‚
            # æ³¨æ„ï¼šæ­¤å¤„å·²ç§»é™¤åŸé¡¹ç›®ç‰¹æœ‰çš„é“¾æ¥å’Œå›¾ç‰‡ï¼Œè¯·æ ¹æ®å®é™…æƒ…å†µè¡¥å……æˆ–åˆ é™¤ã€‚
            # å¦‚æœ CherryHQ/cherry-studio-app æœ‰è‡ªå·±çš„åŒæ­¥æ•™ç¨‹ï¼Œè¯·åœ¨æ­¤å¤„æ·»åŠ é“¾æ¥ã€‚
